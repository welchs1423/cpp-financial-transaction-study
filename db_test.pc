#ifndef ORA_PROC
#include <stdio.h>
#endif
#include <sqlca.h>

EXEC SQL BEGIN DECLARE SECTION;
    // [수정됨] IP 명시 및 AS SYSDBA 추가
    char *user = "system/Password123!@//127.0.0.1:1521/xepdb1";
    char acc_no[20];
    char user_name[40];
    long balance;
EXEC SQL END DECLARE SECTION;

#ifdef ORA_PROC
int printf(const char *format, ...);
#endif

void sql_error(const char *msg){
    printf("\n=== Error Occurred ===\n");
    printf("%s\n", msg);
    // [수정됨] 상세 에러 메시지 출력
    printf("SQL Code: %d\n", sqlca.sqlcode);
    printf("Error Message: %.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc);
    printf("======================\n");
}

int main(){
    // 1. DB 접속
    EXEC SQL CONNECT :user;

    if (sqlca.sqlcode != 0){
        sql_error("DB 연결 실패!");
        return -1;
    }
    printf("오라클 DB 연결 성공!\n");

    // 2. 데이터 조회(SELECT)
    EXEC SQL SELECT ACC_NO, USER_NAME, BALANCE
        INTO :acc_no, :user_name, :balance
        FROM ACCOUNT
        WHERE ACC_NO = '110-123-456';

    if(sqlca.sqlcode == 0){
        printf("\n[조회 결과]\n");
        printf("계좌번호: %s\n", acc_no);
        printf("고객명: %s\n", user_name);
        printf("잔액: %ld\n", balance);
    } else {
        printf("데이터를 찾을 수 없습니다.\n");
        sql_error("SELECT 실패");
    }

    // 3. DB 접속 종료
    EXEC SQL COMMIT RELEASE;

    return 0;
}