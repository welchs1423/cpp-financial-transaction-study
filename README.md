# C-STOCK 프로젝트
C 언어와 Oracle DB를 이용한 계좌 관리 프로그램

## 현재 진행 상황
 - 리눅스 개발 환경 구축 (WSL2)
 - Oracle 21c DB 서버 구축 (Docker)
 - 기본 계좌 테이블 (`ACCOUNT`) 생성 완료
 - C 언어 파일 입출력 로직 구현
 - 동적 사용자 입력 및 ATM 무한 루프 구현 완료

---

## 📖 공통 가이드 및 환경 설정

### 1. 필수 라이브러리 설치
C 언어와 Oracle의 통신을 위해 `libaio1` 패키지 설치.
```bash
sudo apt-get update
sudo apt-get install -y libaio1
```

### 2. Pro*C 컴파일 및 실행 가이드
- **컴파일 순서**:
  1. `.pc` 파일 작성 후 Docker 컨테이너로 전송 (`docker cp`)
  2. 컨테이너 내부에서 `proc` 명령어로 `.c` 파일 생성 (`parse=none` 옵션 필수)
  3. 생성된 `.c` 파일을 다시 호스트(WSL)로 가져와 `gcc`로 빌드
- **주요 컴파일 옵션**:
  - `-I./include`: 오라클 공용 헤더 파일 참조
  - `-L$ORACLE_HOME -lclntsh`: 오라클 클라이언트 공유 라이브러리 링크

---

## 📝 개발 및 트러블슈팅 히스토리 (최신순)

### [2026-02-19] ATM 메뉴 무한루프 구현 및 파싱 에러 해결
- **구현 내역**:
  - `while(1)`과 `switch-case`를 활용하여 프로그램 종료 전까지 입금/출금/조회를 반복할 수 있는 ATM 무한 루프 시스템 도입.
- **트러블슈팅**:
  - **Pro*C 줄바꿈 인식 오류 (unknown type name ‘WHERE’)**:
    - 현상: `gcc` 컴파일 중 SQL의 `WHERE` 절을 C 언어 타입으로 잘못 인식하여 에러 발생.
    - 원인: `parse=none` 옵션 사용 시, Pro*C가 여러 줄로 작성된 `EXEC SQL` 문장을 끝까지 파싱하지 못하고 잘라먹는 현상 발생.
    - 해결: `EXEC SQL`부터 세미콜론(`;`)까지의 쿼리 문장을 줄바꿈 없이 한 줄로 이어서 작성하여 해결.

### [2026-02-18] 사용자 상호작용 및 자동화 적용
- **구현 내역**:
  - 동적 출금 기능 구현 (`scanf`): 하드코딩된 금액 대신 실행 시 사용자로부터 직접 출금액을 입력받도록 개선.
  - 유효성 검사: 0원 이하 입력 방지 및 잔액 부족 시 트랜잭션 보호 로직 검증.
  - 환경 변수 내재화 (`putenv`): 소스 코드 내 `putenv("NLS_LANG=...")` 추가로 터미널 `export` 명령 없이 한글 정상 출력.

### [2026-02-14] 출금 로직 구현 및 빌드 환경 최적화
- **구현 내역**:
  - 트랜잭션 제어: 조회(SELECT) 후 조건 검증을 통한 출금(UPDATE) 로직 구현.
  - 환경 구축: Docker 내부 오라클 헤더를 로컬 빌드 환경(`include/`)에 통합.
- **트러블슈팅**:
  - **GCC 헤더 참조 에러 (sqlda.h, sqlcpr.h)**:
    - 원인: 오라클 전용 헤더 파일들이 표준 include 경로에 없음.
    - 해결: `precomp/public` 디렉토리를 로컬 `./include`로 전체 복사 후 `-I./include` 옵션으로 빌드.
  - **Docker 실행 오류**:
    - 현상: `command 'docker' could not be found` 발생.
    - 원인: Docker Desktop 미실행 및 WSL2 연동 해제.
    - 해결: Docker Desktop 실행 및 Settings에서 WSL Integration 재활성화.
  - **Pro*C 미정의 식별자 에러 (PCC-S-02322)**:
    - 해결: 호스트 변수명 오타 (`user_kd` vs `user_id`) 수정.

### [2026-02-13] 환경 구축 및 구현 완료 내역
- [x] `SELECT` -> `UPDATE` -> `COMMIT` 트랜잭션 로직 구현 및 검증 완료
- [x] 테스트 계정 잔액 **5,000,000원** 도달 확인
- [x] 한글 고객명("홍길동") 정상 출력 및 인코딩 문제 해결
- [x] Pro*C 프리컴파일부터 GCC 빌드까지의 원라인 커맨드 최적화

- **트러블슈팅 로그 (2026-02-13)**
  - **Pro*C 컴파일 에러 (PCC-S-02201)**: 
    - 현상: `stdio.h` 등 시스템 헤더 해석 중 구문 에러 발생.
    - 원인: Pro*C 번역기가 C 표준 라이브러리의 복잡한 매크로 구조를 해석하지 못함.
    - 해결: `proc` 옵션에 `parse=none`을 추가하여 SQL 문장만 해석하도록 설정.
  - **DB 연결 지연 (Hanging)**: 
    - 원인: WSL 환경에서 TNS 서비스 별칭(`xepdb1`) 인식 실패로 인한 무한 대기 발생.
    - 해결: 접속 문자열을 **EZConnect** 방식(`127.0.0.1:1521/xepdb1`)으로 명시하여 해결.
  - **한글 깨짐 및 데이터 주입 오류**: 
    - 현상: 고객명 출력 시 깨진 문자() 발생.
    - 해결: 
      - 도커 접속 시 `-e NLS_LANG=KOREAN_KOREA.AL32UTF8` 옵션을 주입하여 SQL*Plus에서 데이터 업데이트.
      - SQL 문에 `TRIM()` 함수 적용 및 호스트 변수를 `VARCHAR` 타입으로 선언하여 공백 문제 해결.
  - **Bash 특수문자(`!`) 인식 오류**: 
    - 현상: 비밀번호에 `!` 포함 시 `event not found` 발생.
    - 해결: 접속 정보를 **작은따옴표(`' '`)**로 감싸서 리눅스 쉘의 해석 방지.

### [2026-02-12] 환경 구축 완료 내역
- [x] Oracle 21c XE Docker 컨테이너 설치 및 실행
- [x] SQL*Plus를 통한 `ACCOUNT` 테이블 설계 및 데이터 인서트 (`COMMIT` 완료)
- [x] Ubuntu `libaio1` 패키지 설치 및 `sudo` 권한 문제 해결
- [x] Oracle Instant Client 21.13 SDK/Basic 설정
- [x] `.bashrc` 환경 변수 최적화 및 공유 라이브러리(`so`) 링크 검증 완료

- **트러블슈팅 로그 (2026-02-12)**
  - **에러 ORA-12514 (TNS:listener...)**: 
    - 원인: 접속 문자열의 서비스 이름(`xe`)이 실제 리스너에 등록된 이름과 불일치.
    - 해결: 오라클 21c XE의 PDB 서비스 이름인 `xepdb1`으로 접속 문자열 수정.
  - **파일 누락 (sqlcxt.h)**:
    - 현상: `docker cp` 시 오라클 엔진 내에서 `sqlcxt.h`를 찾지 못함.
    - 해결: `sqlcxt` 함수 선언이 포함된 더미 헤더 파일을 직접 생성하여 컴파일 성공.
  - **사용자 권한 문제**:
    - `SYS` 계정 접속 시 반드시 `AS SYSDBA` 문구를 접속 문자열 끝에 포함해야 함.